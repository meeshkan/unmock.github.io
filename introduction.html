<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Introduction · Unmock</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="unmock is an opinionated and scalable way to mock external services in tests."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Introduction · Unmock"/><meta property="og:type" content="website"/><meta property="og:url" content="https://unmock.github.io/"/><meta property="og:description" content="unmock is an opinionated and scalable way to mock external services in tests."/><meta property="og:image" content="https://unmock.github.io/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://unmock.github.io/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/favicon.ico" alt="Unmock"/><h2 class="headerTitleWithLogo">Unmock</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive siteNavItemActive"><a href="/introduction" target="_self">Docs</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Getting started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting started</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/getting-started">Getting started</a></li><li class="navListItem"><a class="navItem" href="/comparison">Comparison to existing tools</a></li><li class="navListItem"><a class="navItem" href="/faq">Frequently asked questions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/services">Services</a></li><li class="navListItem"><a class="navItem" href="/state">Modifying state</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Introduction</h1></header><article><div><span><p>unmock is an opinionated and scalable way to mock external services in tests.</p>
<h2><a class="anchor" aria-hidden="true" id="motivation"></a><a href="#motivation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
<p>Services are the glue connecting modern applications: for example, the GitHub API is a service. Every service has a specification describing how the service behaves, be either written documentation, <a href="https://www.openapis.org/">OpenAPI</a>, <a href="https://raml.org/">RAML</a>, or something else. The specification for a service is <em>reusable</em> across applications.</p>
<p>Still, when testing how our applications integrate with external services, we rarely use the specifications directly. Instead, we write adhoc rules for how the services should behave. Writing such rules is error-prone, time-consuming, and hard to maintain.</p>
<p>This is what unmock wants to fix. Testing the integration with external services should start from the <em>service specification</em>. Setting the service <em>state</em> should happen programmatically before every test. The state should be <em>consistent</em> with the service specification.</p>
<h2><a class="anchor" aria-hidden="true" id="how-it-works"></a><a href="#how-it-works" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How it works</h2>
<p>Let's assume you want to fetch a GitHub organization's email address using <code>fetch</code>:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchGitHubOrganizationEmail</span>(<span class="hljs-params">organization</span>) </span>{
  <span class="hljs-keyword">const</span> headers = <span class="hljs-keyword">new</span> Headers({
    <span class="hljs-attr">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${process.ENV.GITHUB_API_TOKEN}</span>`</span>,
  });
  <span class="hljs-keyword">const</span> organizationData = <span class="hljs-keyword">await</span> fetch(
    <span class="hljs-string">`https://api.github.com/orgs/<span class="hljs-subst">${organization}</span>`</span>,
    headers
  );
  <span class="hljs-keyword">return</span> organizationData.email;
}
</code></pre>
<p>Your test looks like this:</p>
<pre><code class="hljs css language-js">it(<span class="hljs-string">"fetches GitHub organization's email"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> email = <span class="hljs-keyword">await</span> fetchGitHubOrganizationEmail(<span class="hljs-string">"meeshkan"</span>);
  expect(email).toBe(<span class="hljs-string">"contact@meeshkan.com"</span>);  <span class="hljs-comment">// email address for Meeshkan organization</span>
}
</code></pre>
<p>The test would complete successfully if the <code>GITHUB_API_TOKEN</code> environment variable was set properly. However, it is bad practice to hit the API in unit tests, because</p>
<ol>
<li>running unit tests counts against the rate limit,</li>
<li>tests could change production data,</li>
<li>organization's email could change and that would break the test.</li>
</ol>
<p>Let us add unmock to capture outgoing calls and check if the value returned from <code>fetchGitHubOrganizationEmail</code> is a <code>String</code>:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> unmock <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock-node"</span>;

unmock.initialize();  <span class="hljs-comment">// Capture outgoing calls</span>

it(<span class="hljs-string">"fetches GitHub organization's email"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> email = <span class="hljs-keyword">await</span> fetchGitHubOrganizationEmail(<span class="hljs-string">"meeshkan"</span>);
  expect(<span class="hljs-keyword">typeof</span> email).toEqual(<span class="hljs-string">"string"</span>);
}
</code></pre>
<p>To describe what the GitHub service is, we add a yml file:</p>
<pre><code class="hljs css language-yaml"><span class="hljs-comment"># __unmock__/github/index.yml</span>

<span class="hljs-attr">servers:</span>
<span class="hljs-attr">  - https:</span><span class="hljs-string">//api.github.com/</span>

<span class="hljs-attr">paths:</span>
  <span class="hljs-string">/orgs/{org}:</span>
<span class="hljs-attr">    email:</span> <span class="hljs-string">string!</span>
</code></pre>
<p>The test passes now. If you're familiar with the OpenAPI specification, the contents of <code>index.yml</code> should look familiar to you, and indeed the file format is an extension of the OpenAPI specification. Read more about services and their specifications <a href="/services">here</a>.</p>
<p>The specification for the <code>github</code> service defines the email address as any string. This may be all you need to test the function logic, but if you want the service to return a given email address instead of a random string, simply add a call to <code>states.github()</code> to modify the <em>state</em> of the service:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> unmock <span class="hljs-keyword">from</span> <span class="hljs-string">"unmock-node"</span>;

<span class="hljs-keyword">const</span> { states } = unmock.initialize();  <span class="hljs-comment">// Capture outgoing calls</span>

it(<span class="hljs-string">"fetches GitHub organization's email"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// Set the email address returned by the GitHub service:</span>
  states.github({ <span class="hljs-attr">email</span>: <span class="hljs-string">"contact@meeshkan.com"</span> });
  <span class="hljs-keyword">const</span> email = <span class="hljs-keyword">await</span> fetchGitHubOrganizationEmail(<span class="hljs-string">"meeshkan"</span>);
  expect(email).toBe(<span class="hljs-string">"contact@meeshkan.com"</span>);
}
afterAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  unmock.reset();  <span class="hljs-comment">// Reset the state</span>
})
</code></pre>
<p>Get started with unmock <a href="/getting-started">here</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="mission"></a><a href="#mission" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mission</h2>
<p>unmock wants to provide a semantically adequate, mocked version of the services in the internet so you never have to create a mock manually again. Before we get there, we provide best practices for testing external services.</p>
<h2><a class="anchor" aria-hidden="true" id="next-steps"></a><a href="#next-steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next steps</h2>
<ol>
<li><a href="/getting-started">Get started</a> with unmock</li>
<li>Read about <a href="/services">services</a></li>
<li>Read about <a href="/state">unmock DSL and how to modify the service state</a></li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-next button" href="/getting-started"><span>Getting started</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#motivation">Motivation</a></li><li><a href="#how-it-works">How it works</a></li><li><a href="#mission">Mission</a></li><li><a href="#next-steps">Next steps</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.ico" alt="Unmock" width="66" height="58"/></a><div><h5>Docs</h5><a href="/en/introduction.html">Introduction</a><a href="/en/getting-started.html">Getting Started</a></div><div><h5>Community</h5><a href="https://spectrum.chat/unmock">Spectrum Chat</a><a href="https://twitter.com/meeshkanml?lang=en" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://github.com/unmock">GitHub</a></div></section><section class="copyright">Copyright © 2019 Meeshkan</section></footer></div></body></html>